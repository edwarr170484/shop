{{ header }}
<div id="product-product" class="container">
  <div class="row">{{ column_left }}
    {% if column_left and column_right %}
    {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
    {% set class = 'col-sm-9' %}
    {% else %}
    {% set class = 'col-sm-12' %}
    {% endif %}
    <div id="content" class="{{ class }}">{{ content_top }}
      <div class="row">
        <div class="col-12">
          <ul class="breadcrumb">
            {% for breadcrumb in breadcrumbs %}
            <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
            {% endfor %}
          </ul>
        </div>
      </div>
      <div class="row product-data"> 
        {% if column_left or column_right %}
          {% set class = 'col-sm-6' %}
        {% else %}
          {% set class = 'col-sm-8' %}
        {% endif %}
        <div class="{{ class }}"> 
          {% if thumb or images %}
            <ul class="thumbnails">
              {% if thumb %}
                <li>
                <a class="thumbnail" href="{{ popup }}" title="{{ heading_title }}"><img src="{{ thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" /></a></li>
              {% endif %}
              {% if images %}
                {% for image in images %}
                  <li class="image-additional"><a class="thumbnail" href="{{ image.popup }}" title="{{ heading_title }}"> <img src="{{ image.thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" class="img-fluid" /></a></li>
                {% endfor %}
              {% endif %}
            </ul>
          {% endif %}
        </div>
        {% if column_left or column_right %}
          {% set class = 'col-sm-6' %}
        {% else %}
          {% set class = 'col-sm-4' %}
        {% endif %}
        <div class="{{ class }} product-options">
          <h1 class="product-title">{{ heading_title }}</h1>
          <ul class="list-unstyled product-info">
            <li>{{ text_model }}&nbsp;{{ model }}</li>
          </ul>
          {% if price %}
            <div class="product-price">
              <div>Цена:</div>
              {% if not special %}
                <div class="new-price">{{ price }}</div>
              {% else %}
                <div class="old-price">{{ price }}</div>
                <div class="new-price">{{ special }}</div>
              {% endif %}
            </div>
          {% endif %}
          {% if description %}
            <div class="product-description">
              <div class="product-subtitle"><h4>Опиание товара</h4></div>
              <div class="product-text">{{ description }}</div>
            </div>
          {% endif %}
          <div id="product" class="product-option-list"> 
          {% if options %}
            {% set i = 1%}
            {% for option in options %}
              {% if option.type == 'select' %}
                <div class="product-option">
                  <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                    <select name="option[{{ option.product_option_id }}]" id="input-option{{ option.product_option_id }}" class="form-select">
                      <option value="">{{ text_select }}</option>
                      {% for option_value in option.product_option_value %}
                      <option value="{{ option_value.product_option_value_id }}">{{ option_value.name }}
                      {% if option_value.price %}
                      ({{ option_value.price_prefix }}{{ option_value.price }})
                      {% endif %} </option>
                      {% endfor %}
                    </select>
                  </div>
                  {% if i == 1 %}
                    <div class="form-group">
                      <label class="control-label" for="input-quantity">{{ entry_qty }}</label>
                      <div class="input-number">
                        <button type="button" class="input-down" onclick="inputDown($(this))">-</button>
                        <input type="text" name="quantity" value="{{ minimum }}" size="2" id="input-quantity" class="form-control" />
                        <button type="button" class="input-up" onclick="inputUp($(this))">+</button>
                      </div>
                    </div>
                  {% endif %}
                  {% if i == options | length %}
                    <div class="form-group">{{ stock }}</div>
                  {% endif %}
                </div>
              {% endif %}
              {% if option.type == 'radio' %}
                <div class="product-option">
                  <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="control-label">{{ option.name }}</label>
                    {% if option.name == 'Цвет' %}
                      <div id="input-option{{ option.product_option_id }}" class="radio-group color"> 
                        {% for option_value in option.product_option_value %}
                          {% set option_data = option_value.name | split(":") %}
                          <div class="radio" style="border:1px solid {{option_data[1]}}" title="{{option_data[0]}}">
                            <input type="radio" name="option[{{ option.product_option_id }}]" value="{{ option_value.product_option_value_id }}" />
                            <div class="radio-color" style="background-color:{{option_data[1]}}"></div>
                          </div>
                        {% endfor %}
                      </div>
                    {% else %}
                      <div id="input-option{{ option.product_option_id }}" class="radio-group"> 
                        {% for option_value in option.product_option_value %}
                          <div class="radio">
                            <label>
                              
                              <input type="radio" name="option[{{ option.product_option_id }}]" value="{{ option_value.product_option_value_id }}" />
                              {% if option_value.image %} <img src="{{ option_value.image }}" alt="{{ option_value.name }} {% if option_value.price %} {{ option_value.price_prefix }} {{ option_value.price }} {% endif %}" class="img-thumbnail" /> {% endif %}                  
                              {{ option_data[0] }}
                              {% if option_value.price %}
                              ({{ option_value.price_prefix }}{{ option_value.price }})
                              {% endif %} </label>
                          </div>
                        {% endfor %} 
                        </div>
                    {% endif %}
                    
                  </div>
                  {% if i == 1 %}
                    <div class="form-group">
                      <label class="control-label" for="input-quantity">{{ entry_qty }}</label>
                      <input type="text" name="quantity" value="{{ minimum }}" size="2" id="input-quantity" class="form-control" />
                    </div>
                  {% endif %}
                  {% if i == options | length %}
                    <div class="form-group">
                      {{ stock }}
                    </div>
                  {% endif %}
                </div>
              {% endif %}
              {% if option.type == 'checkbox' %}
                <div class="product-option">
                  <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="control-label">{{ option.name }}</label>
                    <div id="input-option{{ option.product_option_id }}"> {% for option_value in option.product_option_value %}
                      <div class="checkbox">
                        <label>
                          <input type="checkbox" name="option[{{ option.product_option_id }}][]" value="{{ option_value.product_option_value_id }}" />
                          {% if option_value.image %} <img src="{{ option_value.image }}" alt="{{ option_value.name }} {% if option_value.price %} {{ option_value.price_prefix }} {{ option_value.price }} {% endif %}" class="img-thumbnail" /> {% endif %}
                          {{ option_value.name }}
                          {% if option_value.price %}
                          ({{ option_value.price_prefix }}{{ option_value.price }})
                          {% endif %} </label>
                      </div>
                      {% endfor %} </div>
                  </div>
                  {% if i == 1 %}
                    <div class="form-group">
                      <label class="control-label" for="input-quantity">{{ entry_qty }}</label>
                      <input type="text" name="quantity" value="{{ minimum }}" size="2" id="input-quantity" class="form-control" />
                    </div>
                  {% endif %}
                  {% if i == options | length %}
                    <div class="form-group">
                      {{ stock }}
                    </div>
                  {% endif %}
                </div>
              {% endif %}
              {% if option.type == 'text' %}
                <div class="product-option">
                  <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                    <input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control" />
                  </div>
                  {% if i == 1 %}
                    <div class="form-group">
                      <label class="control-label" for="input-quantity">{{ entry_qty }}</label>
                      <input type="text" name="quantity" value="{{ minimum }}" size="2" id="input-quantity" class="form-control" />
                    </div>
                  {% endif %}
                  {% if i == options | length %}
                    <div class="form-group">
                      {{ stock }}
                    </div>
                  {% endif %}
                </div>
              {% endif %}
              {% if option.type == 'textarea' %}
                <div class="product-option">
                  <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                    <textarea name="option[{{ option.product_option_id }}]" rows="5" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control">{{ option.value }}</textarea>
                  </div>
                  {% if i == 1 %}
                    <div class="form-group">
                      <label class="control-label" for="input-quantity">{{ entry_qty }}</label>
                      <input type="text" name="quantity" value="{{ minimum }}" size="2" id="input-quantity" class="form-control" />
                    </div>
                  {% endif %}
                  {% if i == options | length %}
                    <div class="form-group">
                      {{ stock }}
                    </div>
                  {% endif %}
                </div>
              {% endif %}
              {% set i = i + 1 %}
            {% endfor %}
            {% endif %}
            <div class="form-group product-buttons">
              <input type="hidden" name="product_id" value="{{ product_id }}" />
              <button type="button" id="button-cart" data-loading-text="{{ text_loading }}" class="btn btn-primary btn-lg btn-block">{{ button_cart }}</button>
              <button type="button" data-toggle="tooltip" class="btn btn-default" title="{{ button_wishlist }}" onclick="wishlist.add('{{ product_id }}');">
                <svg width="44" height="38" viewBox="0 0 44 38" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M35.8811 1.83204L35.8814 1.83211C41.2652 3.65557 44.2704 9.76047 42.4849 15.5285C42.087 16.8077 40.7662 18.7827 38.819 21.1171C36.9062 23.4104 34.4934 25.9302 32.0595 28.2746C29.626 30.6185 27.1881 32.7712 25.2311 34.3319C24.2505 35.1138 23.4059 35.7349 22.7515 36.1554C22.423 36.3665 22.1609 36.515 21.9655 36.6071C21.8944 36.6407 21.8426 36.6616 21.8079 36.6745C21.7742 36.6618 21.7246 36.6413 21.6568 36.609C21.4651 36.5175 21.2078 36.3696 20.8849 36.1587C20.2416 35.7385 19.4123 35.1174 18.4498 34.335C16.529 32.7735 14.1389 30.6195 11.7531 28.2744C9.36704 25.929 7.00147 23.4085 5.1238 21.1159C3.21375 18.7837 1.91177 16.8085 1.51201 15.5282C-0.266666 9.77485 2.73643 3.66832 8.12896 1.83177C13.4393 0.0323406 19.2025 3.01475 21.0551 8.62322L22.0041 11.4962L22.954 8.62354C24.807 3.02027 30.5712 0.0322436 35.8811 1.83204Z" stroke="#507998" stroke-width="2"/>
</svg>

              </button>
            </div>
            {% if minimum > 1 %}
              <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ text_minimum }}</div>
            {% endif %}</div>
         </div>
      </div>
      {% if products %}
        <div class="row">
          <div class="featured-module">
            <div class="module-header text-center no-border p-0">
              <h3>{{ text_related }}</h3>
            </div>
            <div class="row">
              <div class="col-12">
                <div class="product-grid">
                  {% for product in products %}
                    <div class="product-layout">
                      <div class="product-layout-inner">
                        <div class="image"><a href="{{ product.href }}"><img src="{{ product.thumb }}" alt="{{ product.name }}" title="{{ product.name }}" class="img-fluid" /></a></div>
                        <div class="caption">
                          <h4><a href="{{ product.href }}">{{ product.name }}</a></h4>
                          {% if product.price %}
                          <p class="price">
                            {% if not product.special %}
                              {{ product.price }}
                            {% else %}
                              {{ product.special }}
                            {% endif %}
                          </p>
                          {% endif %}
                        </div>
                        <button type="button" data-toggle="tooltip" title="{{ button_wishlist }}" onclick="wishlist.add('{{ product.product_id }}');">
                          <svg width="25" height="22" viewBox="0 0 25 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.5694 0.761173C17.2331 -0.363749 13.6475 1.51355 12.5026 4.95769C11.3578 1.50993 7.77216 -0.363749 4.43588 0.761173C1.06096 1.90438 -0.779261 5.6809 0.316487 9.20544C1.37005 12.5656 11.1401 21.565 12.3902 21.565C13.6405 21.565 23.6283 12.5765 24.6818 9.20544C25.781 5.6736 23.9408 1.89707 20.5694 0.761173Z" fill="#FF7373"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div> 
        </div>
      {% endif %}
      {{ content_bottom }}</div>
    {{ column_right }}</div>
</div>
<script type="text/javascript"><!--
$('select[name=\'recurring_id\'], input[name="quantity"]').change(function(){
	$.ajax({
		url: 'index.php?route=product/product/getRecurringDescription',
		type: 'post',
		data: $('input[name=\'product_id\'], input[name=\'quantity\'], select[name=\'recurring_id\']'),
		dataType: 'json',
		beforeSend: function() {
			$('#recurring-description').html('');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();

			if (json['success']) {
				$('#recurring-description').html(json['success']);
			}
		}
	});
});
//--></script> 
<script type="text/javascript"><!--
$('#button-cart').on('click', function() {
	$.ajax({
		url: 'index.php?route=checkout/cart/add',
		type: 'post',
		data: $('#product input[type=\'text\'], #product input[type=\'hidden\'], #product input[type=\'radio\']:checked, #product input[type=\'checkbox\']:checked, #product select, #product textarea'),
		dataType: 'json',
		beforeSend: function() {
			$('#button-cart').button('loading');
		},
		complete: function() {
			$('#button-cart').button('reset');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();
			$('.form-group').removeClass('has-error');

			if (json['error']) {
				if (json['error']['option']) {
					for (i in json['error']['option']) {
						var element = $('#input-option' + i.replace('_', '-'));

						if (element.parent().hasClass('input-group')) {
							element.parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						} else {
							element.after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						}
					}
				}

				if (json['error']['recurring']) {
					$('select[name=\'recurring_id\']').after('<div class="text-danger">' + json['error']['recurring'] + '</div>');
				}

				// Highlight any found errors
				$('.text-danger').parent().addClass('has-error');
			}

			if (json['success']) {
				$('.breadcrumb').after('<div class="alert alert-success alert-dismissible fade show" role="alert">' + json['success'] + '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>');

				let cart_total =
            json["total"] > 0
              ? `<span id="cart-total">${json["total"]}</span>`
              : ``;
          setTimeout(function () {
            $(".header-cart > a").html(
              `<img src="catalog/view/theme/default/image/icons/header-cart.svg" alt="" />${cart_total}`
            );
          }, 100);

				$('html, body').animate({ scrollTop: 0 }, 'slow');
			}
		},
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
	});
});
//--></script> 
<script type="text/javascript"><!--
$('.date').datetimepicker({
	language: '{{ datepicker }}',
	pickTime: false
});

$('.datetime').datetimepicker({
	language: '{{ datepicker }}',
	pickDate: true,
	pickTime: true
});

$('.time').datetimepicker({
	language: '{{ datepicker }}',
	pickDate: false
});

$('button[id^=\'button-upload\']').on('click', function() {
	var node = this;

	$('#form-upload').remove();

	$('body').prepend('<form enctype="multipart/form-data" id="form-upload" style="display: none;"><input type="file" name="file" /></form>');

	$('#form-upload input[name=\'file\']').trigger('click');

	if (typeof timer != 'undefined') {
    	clearInterval(timer);
	}

	timer = setInterval(function() {
		if ($('#form-upload input[name=\'file\']').val() != '') {
			clearInterval(timer);

			$.ajax({
				url: 'index.php?route=tool/upload',
				type: 'post',
				dataType: 'json',
				data: new FormData($('#form-upload')[0]),
				cache: false,
				contentType: false,
				processData: false,
				beforeSend: function() {
					$(node).button('loading');
				},
				complete: function() {
					$(node).button('reset');
				},
				success: function(json) {
					$('.text-danger').remove();

					if (json['error']) {
						$(node).parent().find('input').after('<div class="text-danger">' + json['error'] + '</div>');
					}

					if (json['success']) {
						alert(json['success']);

						$(node).parent().find('input').val(json['code']);
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
				}
			});
		}
	}, 500);
});
//--></script> 
<script type="text/javascript"><!--
$('#review').delegate('.pagination a', 'click', function(e) {
    e.preventDefault();

    $('#review').fadeOut('slow');

    $('#review').load(this.href);

    $('#review').fadeIn('slow');
});

$('#review').load('index.php?route=product/product/review&product_id={{ product_id }}');

$('#button-review').on('click', function() {
	$.ajax({
		url: 'index.php?route=product/product/write&product_id={{ product_id }}',
		type: 'post',
		dataType: 'json',
		data: $("#form-review").serialize(),
		beforeSend: function() {
			$('#button-review').button('loading');
		},
		complete: function() {
			$('#button-review').button('reset');
		},
		success: function(json) {
			$('.alert-dismissible').remove();

			if (json['error']) {
				$('#review').after('<div class="alert alert-danger alert-dismissible fade show" role="alert">' + json['error'] + '</div>');
			}

			if (json['success']) {
				$('#review').after('<div class="alert alert-success alert-dismissible fade show" role="alert"> ' + json['success'] + '</div>');

				$('input[name=\'name\']').val('');
				$('textarea[name=\'text\']').val('');
				$('input[name=\'rating\']:checked').prop('checked', false);
			}
		}
	});
});

$(document).ready(function() {
	$('.thumbnails').magnificPopup({
		type:'image',
		delegate: 'a',
		gallery: {
			enabled: true
		}
	});
});
//--></script> 
{{ footer }} 
